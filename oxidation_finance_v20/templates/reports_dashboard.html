{% extends "base.html" %}

{% block title %}报表看板 - 氧化加工厂财务系统{% endblock %}

{% block content %}
<div class="card">
  <h2>报表看板</h2>
  <div style="display:flex; flex-wrap:wrap; gap:20px;">
    <div style="flex:1 1 300px; min-width:300px;">
      <h3>汇总</h3>
      <ul style="list-style:none; padding:0; margin:0;">
        <li>总收入: {{ data.summary.total_income }}</li>
        <li>总支出: {{ data.summary.total_expense }}</li>
        <li>订单数量: {{ data.summary.order_count }}</li>
        <li>利润: {{ data.summary.profit }}</li>
      </ul>
    </div>
  <div style="flex:1 1 300px; min-width:300px;">
      <h3>本月利润趋势</h3>
      <div class="chart" style="height:180px; display:flex; align-items:flex-end; gap:6px;">
        {% if data.monthly %}
          {% set max_p = 0 %}
          {% for m in data.monthly %}
            {% if m.profit > max_p %}{% set max_p = m.profit %}{% endif %}
          {% endfor %}
          {% for m in data.monthly %}
            {% set h = 0 %}
            {% if max_p > 0 %}{% set h = (m.profit / max_p) * 180 %}{% endif %}
            <div style="width:24px; height:{{ h|int }}px; background:#3b82f6; display:inline-block;"></div>
          {% endfor %}
        {% else %}
          <span>无数据</span>
        {% endif %}
      </div>
      <div style="display:flex; justify-content: space-between; margin-top:6px; font-size:12px; color:#666;">
        {% for m in data.monthly %}
        <span style="width:24px; text-align:center;">{{ m.month[-2:] }}</span>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<div class="card">
  <h3>Top 客户</h3>
  <table>
    <thead><tr><th>名称</th><th>订单数</th><th>总额</th></tr></thead>
    <tbody>
      {% for c in data.top_customers %}
      <tr><td>{{ c.name }}</td><td>{{ c.order_count }}</td><td>{{ c.total }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card">
  <h3>支出类型</h3>
  <table>
    <thead><tr><th>类型</th><th>总额</th></tr></thead>
    <tbody>
      {% for e in data.expense_by_type %}
      <tr><td>{{ e.expense_type }}</td><td>{{ e.total }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
