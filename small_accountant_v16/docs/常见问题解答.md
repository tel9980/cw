# V1.6 小会计实用增强版 - 常见问题解答（FAQ）

## 目录

1. [安装和配置](#安装和配置)
2. [数据导入](#数据导入)
3. [报表生成](#报表生成)
4. [提醒系统](#提醒系统)
5. [对账功能](#对账功能)
6. [错误处理](#错误处理)
7. [性能优化](#性能优化)

---

## 安装和配置

### Q1: 系统需要什么运行环境？

**A**: 系统要求：
- Python 3.8 或更高版本
- Windows/Linux/macOS 操作系统
- 至少 100MB 可用磁盘空间
- 建议 2GB 以上内存

**安装步骤**：
```bash
# 1. 克隆或下载项目
# 2. 安装依赖
pip install -r requirements.txt

# 3. 验证安装
python -m pytest small_accountant_v16/tests/ -v
```

### Q2: 首次运行需要做什么配置？

**A**: 首次运行会自动创建：
- 配置文件：`config.json`
- 数据目录：`data/`
- 报表目录：`reports/`
- 备份目录：`backups/`
- 日志目录：`logs/`

**建议配置**：
1. 设置企业微信Webhook（可选）
2. 调整提醒时间和频率
3. 配置报表输出目录

### Q3: 如何备份和恢复数据？

**A**: 

**自动备份**：
- 配置文件每次保存时自动备份
- 保留最近10个备份

**手动备份**：
```bash
# 备份整个data目录
cp -r data/ backups/data_backup_$(date +%Y%m%d)
```

**恢复数据**：
```bash
# 从备份恢复
cp -r backups/data_backup_20260210/ data/
```

### Q4: 如何迁移到新电脑？

**A**: 

**导出数据**：
1. 复制整个项目目录
2. 或只复制以下文件/目录：
   - `data/` - 所有数据文件
   - `config.json` - 配置文件
   - `reports/` - 历史报表（可选）

**导入数据**：
1. 在新电脑安装系统
2. 将导出的文件复制到对应位置
3. 运行系统验证

---

## 数据导入

### Q5: Excel导入时提示"列名无法识别"怎么办？

**A**: 

**原因**：Excel列名与系统预期不匹配

**解决方法**：

**方法1：使用标准列名**
```
日期、类型、金额、往来单位、摘要、类别、状态
```

**方法2：使用列名变体**

系统支持以下变体：
- 日期：日期、时间、交易日期、发生日期
- 金额：金额、交易金额、发生额
- 类型：类型、交易类型、收支类型

**方法3：手动映射**
```
主菜单 → Excel批量导入 → 列映射设置
```

### Q6: 导入时部分数据失败怎么办？

**A**: 

**查看错误详情**：
```
导入结果：
成功：98条
失败：2条

失败详情：
- 第15行：金额格式错误（"一万" 应为 "10000"）
- 第67行：日期格式错误（"2026/1/15" 应为 "2026-01-15"）
```

**常见错误及解决**：

| 错误类型 | 原因 | 解决方法 |
|---------|------|---------|
| 金额格式错误 | 包含非数字字符 | 删除货币符号、逗号等 |
| 日期格式错误 | 格式不是YYYY-MM-DD | 统一使用标准格式 |
| 往来单位不存在 | 系统中没有该单位 | 先导入往来单位 |
| 必填字段为空 | 缺少必填信息 | 补充完整数据 |

**修复后重新导入**：
1. 修正Excel文件中的错误
2. 重新导入
3. 或使用"跳过错误行"选项

### Q7: 如何撤销错误的导入？

**A**: 

**撤销步骤**：
```
主菜单 → Excel批量导入 → 导入历史 → 选择导入记录 → 撤销导入
```

**注意事项**：
- ⚠️ 撤销操作不可恢复
- ⚠️ 只能撤销最近的导入
- ⚠️ 如果数据已被修改，撤销可能不完整

**建议**：
- 导入前先预览
- 使用小批量测试导入
- 重要数据先备份

### Q8: 大批量数据导入很慢怎么办？

**A**: 

**优化建议**：

1. **分批导入**
   - 每批不超过1000条
   - 避免单次导入过多数据

2. **关闭实时验证**
   - 在导入设置中关闭"实时验证"
   - 导入后再统一验证

3. **使用命令行导入**
   ```python
   from small_accountant_v16.import_engine import ImportEngine
   
   engine = ImportEngine()
   result = engine.import_transactions("large_file.xlsx")
   ```

**性能参考**：
- 100条记录：< 5秒
- 1000条记录：< 30秒
- 10000条记录：< 5分钟

---

## 报表生成

### Q9: 生成的报表没有数据怎么办？

**A**: 

**可能原因**：

1. **日期范围内没有数据**
   - 检查选择的日期范围
   - 确认该期间有交易记录

2. **数据筛选条件过严**
   - 检查是否设置了过滤条件
   - 尝试放宽筛选条件

3. **数据状态不符**
   - 检查交易状态（是否为"已完成"）
   - 确认数据没有被删除

**解决方法**：
```
1. 查看数据统计
   主菜单 → 系统配置 → 数据统计
   
2. 调整日期范围
   选择更大的日期范围重新生成
   
3. 检查数据完整性
   运行数据验证工具
```

### Q10: 报表中的图表显示不正常怎么办？

**A**: 

**常见问题**：

1. **图表为空**
   - 原因：数据量太少（< 3条）
   - 解决：增加数据或选择更大日期范围

2. **图表重叠**
   - 原因：数据点太多
   - 解决：调整图表大小或数据聚合级别

3. **中文乱码**
   - 原因：字体不支持中文
   - 解决：安装中文字体或使用系统默认字体

**修复步骤**：
```python
# 检查matplotlib配置
import matplotlib.pyplot as plt
print(plt.rcParams['font.sans-serif'])

# 设置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False
```

### Q11: 如何自定义报表模板？

**A**: 

**修改报表模板**：

1. **找到模板文件**
   ```
   small_accountant_v16/reports/report_template.py
   ```

2. **修改模板内容**
   - 调整工作表结构
   - 修改列名和格式
   - 添加自定义计算

3. **测试修改**
   ```bash
   python -m pytest small_accountant_v16/tests/test_report_template.py
   ```

**示例：添加自定义列**
```python
# 在报表模板中添加
def add_custom_column(self, worksheet, data):
    worksheet.write('A1', '自定义列')
    # 添加数据...
```

---

## 提醒系统

### Q12: 桌面通知不显示怎么办？

**A**: 

**检查步骤**：

1. **检查plyer库是否安装**
   ```bash
   pip install plyer
   ```

2. **检查系统通知权限**
   - Windows：设置 → 系统 → 通知
   - macOS：系统偏好设置 → 通知
   - Linux：检查通知守护进程

3. **测试通知功能**
   ```python
   from small_accountant_v16.reminders import NotificationService
   
   service = NotificationService()
   service.send_desktop_notification("测试", "这是测试通知")
   ```

**替代方案**：
- 使用企业微信通知
- 查看系统日志获取提醒信息

### Q13: 企业微信通知发送失败怎么办？

**A**: 

**常见错误**：

1. **Webhook URL错误**
   ```
   错误：invalid webhook url
   解决：检查URL是否完整正确
   ```

2. **网络连接问题**
   ```
   错误：connection timeout
   解决：检查网络连接和防火墙设置
   ```

3. **消息格式错误**
   ```
   错误：invalid message format
   解决：检查消息内容是否符合企业微信要求
   ```

**测试步骤**：
```
主菜单 → 系统配置 → 企业微信配置 → 测试通知
```

**调试方法**：
```python
# 查看详细错误信息
import logging
logging.basicConfig(level=logging.DEBUG)

# 发送测试通知
service.send_wechat_notification("测试", "测试内容")
```

### Q14: 如何修改提醒时间？

**A**: 

**修改步骤**：
```
主菜单 → 系统配置 → 提醒配置 → 调度设置
```

**可配置项**：
- 检查时间：每天几点检查（默认09:00）
- 检查频率：每日/每周/每月
- 提醒天数：提前几天提醒

**示例配置**：
```json
{
  "reminder": {
    "tax_reminder_days": [10, 5, 3, 0],
    "check_interval_minutes": 30,
    "check_time": "09:00"
  }
}
```

### Q15: 催款函如何自定义内容？

**A**: 

**修改模板**：

1. **找到模板文件**
   ```
   small_accountant_v16/reminders/collection_letter_generator.py
   ```

2. **修改模板内容**
   ```python
   TEMPLATES = {
       "first_reminder": """
       尊敬的{customer_name}：
       
       您好！根据我司记录，贵司尚有{amount}元款项未支付...
       [自定义内容]
       """
   }
   ```

3. **测试生成**
   ```bash
   python -m pytest small_accountant_v16/tests/test_collection_letter_generator.py
   ```

**可自定义内容**：
- 称呼和问候语
- 催款理由和依据
- 付款方式和账户信息
- 联系方式
- 法律条款

---

## 对账功能

### Q16: 银行流水对账匹配率低怎么办？

**A**: 

**提高匹配率的方法**：

1. **调整匹配容差**
   ```
   主菜单 → 对账助手 → 对账设置
   
   金额容差：±1元 → ±5元
   日期容差：±3天 → ±7天
   ```

2. **完善交易记录**
   - 确保摘要信息完整
   - 补充对方账户信息
   - 统一往来单位名称

3. **使用手动匹配**
   ```
   对账结果 → 未匹配记录 → 手动匹配
   ```

**匹配规则优先级**：
1. 金额+日期+对方名称（精确匹配）
2. 金额+日期（容差匹配）
3. 金额+对方名称（模糊匹配）

### Q17: 对账单格式如何调整？

**A**: 

**修改对账单模板**：

1. **Excel格式**
   ```
   small_accountant_v16/reconciliation/reconciliation_report_generator.py
   ```

2. **HTML格式**
   - 修改HTML模板
   - 调整CSS样式

**常见调整**：
- 添加公司Logo
- 修改表头信息
- 调整列宽和格式
- 添加签字栏

**示例**：
```python
def customize_statement(self, worksheet):
    # 添加公司Logo
    worksheet.insert_image('A1', 'logo.png')
    
    # 调整列宽
    worksheet.set_column('A:A', 15)
    worksheet.set_column('B:B', 30)
```

---

## 错误处理

### Q18: 系统运行时出现错误怎么办？

**A**: 

**错误处理流程**：

1. **查看错误信息**
   - 记录完整的错误消息
   - 注意错误类型和位置

2. **查看日志文件**
   ```bash
   cat logs/small_accountant_YYYYMMDD.log
   ```

3. **常见错误及解决**：

| 错误类型 | 可能原因 | 解决方法 |
|---------|---------|---------|
| FileNotFoundError | 文件不存在 | 检查文件路径 |
| ValueError | 数据格式错误 | 验证数据格式 |
| PermissionError | 权限不足 | 检查文件权限 |
| ConnectionError | 网络问题 | 检查网络连接 |

4. **重启系统**
   ```bash
   # 停止系统
   Ctrl+C
   
   # 重新启动
   python small_accountant_v16/run_cli.py
   ```

### Q19: 数据文件损坏怎么办？

**A**: 

**恢复步骤**：

1. **从备份恢复**
   ```bash
   cp backups/data_backup_latest/* data/
   ```

2. **验证数据完整性**
   ```python
   from small_accountant_v16.storage import TransactionStorage
   
   storage = TransactionStorage()
   transactions = storage.get_all()
   print(f"共有 {len(transactions)} 条记录")
   ```

3. **修复损坏文件**
   ```python
   # 如果JSON文件损坏
   import json
   
   try:
       with open('data/transactions.json', 'r') as f:
           data = json.load(f)
   except json.JSONDecodeError:
       # 尝试修复或重建
       pass
   ```

**预防措施**：
- 定期备份数据
- 使用版本控制
- 避免手动编辑数据文件

### Q20: 如何重置系统到初始状态？

**A**: 

**完全重置**：

```bash
# 1. 备份重要数据
cp -r data/ backups/data_backup_before_reset/

# 2. 删除所有数据
rm -rf data/*
rm -rf reports/*
rm config.json

# 3. 重新初始化
python small_accountant_v16/run_cli.py
```

**部分重置**：

```bash
# 只重置配置
rm config.json

# 只清空数据
rm -rf data/*

# 只清空报表
rm -rf reports/*
```

---

## 性能优化

### Q21: 系统运行变慢怎么办？

**A**: 

**性能优化建议**：

1. **清理历史数据**
   ```
   主菜单 → 系统配置 → 数据管理 → 归档历史数据
   ```

2. **优化数据文件**
   - 定期整理数据文件
   - 删除无用的导入历史
   - 清理过期的备份

3. **调整配置**
   ```json
   {
     "performance": {
       "cache_enabled": true,
       "batch_size": 100,
       "max_records": 10000
     }
   }
   ```

**性能监控**：
```python
# 查看系统性能
from small_accountant_v16.core import PerformanceMonitor

monitor = PerformanceMonitor()
stats = monitor.get_statistics()
print(stats)
```

### Q22: 如何处理大量数据？

**A**: 

**大数据处理策略**：

1. **分批处理**
   ```python
   # 分批读取数据
   batch_size = 1000
   for i in range(0, total_records, batch_size):
       batch = storage.get_batch(i, batch_size)
       process_batch(batch)
   ```

2. **使用数据库**
   - 考虑迁移到SQLite
   - 使用索引加速查询

3. **数据归档**
   - 归档历史数据
   - 只保留近期活跃数据

**数据量建议**：
- JSON存储：< 10,000条记录
- SQLite存储：< 100,000条记录
- 更大数据量：考虑专业数据库

---

## 其他问题

### Q23: 如何获取技术支持？

**A**: 

**支持渠道**：

1. **查看文档**
   - 快速开始指南
   - 功能使用说明
   - 本FAQ文档

2. **查看日志**
   ```bash
   cat logs/small_accountant_YYYYMMDD.log
   ```

3. **运行诊断**
   ```bash
   python -m pytest small_accountant_v16/tests/ -v
   ```

4. **提交问题**
   - 描述问题现象
   - 提供错误日志
   - 说明操作步骤

### Q24: 系统有哪些限制？

**A**: 

**当前限制**：

| 项目 | 限制 | 说明 |
|------|------|------|
| 数据量 | 建议<10,000条 | JSON存储限制 |
| 并发用户 | 单用户 | 本地文件存储 |
| 文件大小 | Excel<10MB | 导入性能考虑 |
| 报表数量 | 无限制 | 受磁盘空间限制 |

**未来改进**：
- 支持数据库存储
- 支持多用户
- 支持更大文件导入
- 支持云端同步

### Q25: 如何升级到新版本？

**A**: 

**升级步骤**：

1. **备份数据**
   ```bash
   cp -r data/ backups/data_backup_before_upgrade/
   cp config.json backups/
   ```

2. **更新代码**
   ```bash
   git pull origin main
   # 或下载新版本
   ```

3. **更新依赖**
   ```bash
   pip install -r requirements.txt --upgrade
   ```

4. **运行迁移**
   ```bash
   python small_accountant_v16/migrate.py
   ```

5. **验证升级**
   ```bash
   python -m pytest small_accountant_v16/tests/ -v
   ```

**注意事项**：
- 升级前务必备份
- 查看版本更新说明
- 测试核心功能

---

**还有其他问题？**

查看更多文档：
- [快速开始指南](快速开始指南.md)
- [功能使用说明](功能使用说明.md)

或查看系统日志获取详细信息：
```bash
cat logs/small_accountant_YYYYMMDD.log
```
