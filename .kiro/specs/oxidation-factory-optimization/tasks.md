# 任务列表：氧化加工厂财务助手系统优化

## 阶段 1：基础架构和数据模型 (Phase 1)

### 1.1 创建配置文件和数据结构
- [ ] 1.1.1 创建 `oxidation_config.json` 配置文件
  - 定义计价单位列表
  - 定义外发工序类型
  - 定义原材料类型
  - 配置银行账户信息
  - 定义默认费用分类
- [ ] 1.1.2 创建 `oxidation_factory` 模块目录结构
  - 创建 `__init__.py`
  - 创建 `config.py` 配置管理模块
  - 创建模块导入结构
- [ ] 1.1.3 实现配置加载函数
  - 实现分层配置加载（默认→行业→用户）
  - 实现配置验证
  - 实现配置热重载

### 1.2 扩展飞书多维表格结构
- [ ] 1.2.1 创建"加工订单表"
  - 定义表结构和字段类型
  - 创建表格初始化函数
  - 添加示例数据
- [ ] 1.2.2 扩展"日常台账表"
  - 添加关联订单号字段
  - 添加对账状态字段
  - 添加对账金额字段
  - 添加对账时间字段
  - 添加对账备注字段
- [ ] 1.2.3 创建"往来单位表"
  - 定义表结构
  - 实现别名列表字段
  - 添加应收应付余额字段
- [ ] 1.2.4 创建"对账记录表"
  - 定义表结构
  - 实现多对多关联
  - 添加对账历史追踪
- [ ] 1.2.5 创建"费用分类规则表"
  - 定义规则结构
  - 实现优先级机制
  - 添加启用/禁用开关

## 阶段 2：订单管理模块 (Phase 2)

### 2.1 实现订单管理核心功能
- [ ] 2.1.1 创建 `order_manager.py` 模块
  - 定义 `OrderManager` 类
  - 实现订单数据模型
- [ ] 2.1.2 实现订单创建功能
  - 实现订单信息验证
  - 实现计价单位支持
  - 实现订单金额自动计算
  - 实现订单保存到飞书
- [ ] 2.1.3 实现订单查询功能
  - 按客户查询
  - 按日期范围查询
  - 按订单状态查询
  - 按订单号查询
- [ ] 2.1.4 实现订单更新功能
  - 更新订单状态
  - 更新已收款金额
  - 更新外发成本
  - 记录修改历史
- [ ] 2.1.5 实现订单统计功能
  - 统计订单总额
  - 统计未收款金额
  - 按客户统计
  - 按计价单位统计

### 2.2 实现订单录入向导
- [ ] 2.2.1 设计分步向导界面
  - 步骤1：基本信息输入
  - 步骤2：计价信息输入
  - 步骤3：工序信息输入
  - 步骤4：确认信息
- [ ] 2.2.2 实现向导交互逻辑
  - 实现步骤导航
  - 实现数据验证
  - 实现自动计算
  - 实现错误提示
- [ ] 2.2.3 实现订单模板功能
  - 提供常用订单模板
  - 支持保存自定义模板
  - 支持从模板创建订单

## 阶段 3：对账引擎 (Phase 3)

### 3.1 实现灵活对账算法
- [ ] 3.1.1 创建 `reconciliation.py` 模块
  - 定义 `ReconciliationEngine` 类
  - 实现对账数据模型
- [ ] 3.1.2 实现精确匹配算法
  - 金额完全相等匹配
  - 日期范围匹配
  - 往来单位匹配
- [ ] 3.1.3 实现部分对账算法
  - 一笔流水对应多个订单
  - 多笔流水对应一个订单
  - 余额计算和更新
- [ ] 3.1.4 实现自动对账功能
  - 批量自动匹配
  - 匹配结果预览
  - 匹配置信度评分
- [ ] 3.1.5 实现手动对账功能
  - 手动选择匹配项
  - 手动调整对账金额
  - 对账关系确认

### 3.2 实现对账操作界面
- [ ] 3.2.1 设计对账界面布局
  - 未对账流水列表
  - 未收款订单列表
  - 对账预览区域
- [ ] 3.2.2 实现对账交互功能
  - 多选功能
  - 拖拽匹配
  - 实时金额计算
  - 对账确认
- [ ] 3.2.3 实现对账记录管理
  - 保存对账记录
  - 查询对账历史
  - 撤销对账操作
  - 导出对账报告

### 3.3 实现余额管理
- [ ] 3.3.1 实现应收应付余额计算
  - 实时计算往来单位余额
  - 更新余额到往来单位表
  - 余额变动历史记录
- [ ] 3.3.2 实现余额预警功能
  - 超期未收款预警
  - 大额应收预警
  - 余额异常检测

## 阶段 4：AI分类优化 (Phase 4)

### 4.1 实现行业分类器
- [ ] 4.1.1 创建 `industry_classifier.py` 模块
  - 定义 `IndustryClassifier` 类
  - 实现分类器接口
- [ ] 4.1.2 实现氧化加工行业规则库
  - 定义原材料关键词规则
  - 定义外发加工关键词规则
  - 定义固定支出关键词规则
  - 定义收入关键词规则
- [ ] 4.1.3 优化AI分类提示词
  - 添加行业上下文
  - 优化分类选项
  - 提高分类准确率
- [ ] 4.1.4 实现分类置信度评估
  - 计算置信度分数
  - 设置置信度阈值
  - 标记低置信度结果

### 4.2 实现分类学习机制
- [ ] 4.2.1 实现用户修正记录
  - 记录修正前后的分类
  - 记录修正时间和用户
  - 保存到本地缓存
- [ ] 4.2.2 实现规则自动优化
  - 分析修正数据
  - 提取新规则
  - 更新规则库
- [ ] 4.2.3 实现分类准确率统计
  - 统计AI分类准确率
  - 统计规则匹配率
  - 生成优化建议报告

## 阶段 5：报表生成 (Phase 5)

### 5.1 实现报表生成器
- [ ] 5.1.1 创建 `report_generator.py` 模块
  - 定义 `ReportGenerator` 类
  - 实现报表基类
- [ ] 5.1.2 实现加工费收入明细表
  - 按客户统计
  - 按计价单位统计
  - 按时间维度统计
  - 生成Excel报表
- [ ] 5.1.3 实现外发成本统计表
  - 按工序类型统计
  - 按供应商统计
  - 成本占比分析
  - 生成Excel报表
- [ ] 5.1.4 实现原材料消耗统计表
  - 按材料类型统计
  - 按时间维度统计
  - 消耗趋势分析
  - 生成Excel报表
- [ ] 5.1.5 实现往来对账表
  - 显示应收应付余额
  - 显示对账明细
  - 显示超期未收款
  - 生成Excel报表
- [ ] 5.1.6 实现月度利润表
  - 收入汇总
  - 成本汇总
  - 费用汇总
  - 利润计算
  - 生成Excel报表

### 5.2 优化报表格式
- [ ] 5.2.1 实现报表样式美化
  - 设置表头样式
  - 设置数据格式
  - 添加边框和颜色
  - 自动调整列宽
- [ ] 5.2.2 实现报表图表
  - 收入趋势图
  - 成本结构饼图
  - 客户占比图
  - 嵌入到Excel

## 阶段 6：示例数据和模板 (Phase 6)

### 6.1 创建示例数据生成器
- [ ] 6.1.1 创建 `demo_data.py` 模块
  - 定义示例数据生成函数
  - 实现数据随机化
- [ ] 6.1.2 生成示例订单数据
  - 10个典型加工订单
  - 覆盖所有计价单位
  - 包含外发工序
  - 包含不同订单状态
- [ ] 6.1.3 生成示例银行流水
  - 30条银行流水
  - 包含客户付款
  - 包含供应商付款
  - 包含固定支出
  - 包含多笔合并和分批场景
- [ ] 6.1.4 生成示例往来单位
  - 5个客户（含别名）
  - 8个供应商
  - 2个既是客户又是供应商
  - 包含联系信息

### 6.2 创建导入模板
- [ ] 6.2.1 创建加工订单导入模板
  - 定义Excel表头
  - 添加字段说明
  - 添加示例数据
  - 添加数据验证规则
- [ ] 6.2.2 创建银行流水导入模板
  - 定义Excel表头
  - 添加字段说明
  - 添加示例数据
  - 支持多种银行格式
- [ ] 6.2.3 创建往来单位导入模板
  - 定义Excel表头
  - 添加别名配置说明
  - 添加示例数据
  - 添加数据验证规则

### 6.3 实现一键加载示例数据
- [ ] 6.3.1 实现示例数据加载功能
  - 检测是否已有数据
  - 提示用户确认
  - 批量导入示例数据
  - 显示导入结果
- [ ] 6.3.2 实现示例数据清除功能
  - 清除示例订单
  - 清除示例流水
  - 清除示例往来单位
  - 保留用户真实数据

## 阶段 7：用户界面优化 (Phase 7)

### 7.1 优化主菜单
- [ ] 7.1.1 重新设计主菜单结构
  - 快捷操作区
  - 数据管理区
  - 报表查询区
  - 系统设置区
- [ ] 7.1.2 实现菜单导航优化
  - 添加菜单编号
  - 添加图标和颜色
  - 添加功能描述
  - 支持快捷键

### 7.2 实现操作向导
- [ ] 7.2.1 实现首次使用向导
  - 欢迎界面
  - 配置引导
  - 示例数据加载
  - 功能介绍
- [ ] 7.2.2 实现操作提示系统
  - 关键步骤提示
  - 错误提示优化
  - 成功提示优化
  - 帮助文档链接

### 7.3 实现进度显示
- [ ] 7.3.1 实现进度条组件
  - 文本进度条
  - 百分比显示
  - 预计剩余时间
- [ ] 7.3.2 在长时间操作中使用进度条
  - 批量导入
  - 报表生成
  - 数据备份
  - 对账处理

## 阶段 8：数据验证和完整性 (Phase 8)

### 8.1 实现数据验证
- [ ] 8.1.1 实现订单数据验证
  - 必填字段检查
  - 金额格式验证
  - 日期合理性验证
  - 计价单位验证
- [ ] 8.1.2 实现银行流水验证
  - 必填字段检查
  - 金额格式验证
  - 日期格式验证
  - 重复记录检测
- [ ] 8.1.3 实现往来单位验证
  - 名称唯一性检查
  - 联系方式格式验证
  - 别名冲突检测

### 8.2 实现数据完整性检查
- [ ] 8.2.1 实现异常数据检测
  - 检测异常金额
  - 检测异常日期
  - 检测孤立记录
  - 检测数据不一致
- [ ] 8.2.2 生成异常报告
  - 列出所有异常项
  - 提供修复建议
  - 支持一键修复
  - 导出异常报告

## 阶段 9：性能优化 (Phase 9)

### 9.1 实现缓存机制
- [ ] 9.1.1 实现往来单位缓存
  - 内存缓存
  - TTL过期机制
  - 缓存刷新
- [ ] 9.1.2 实现AI分类结果缓存
  - 持久化缓存
  - 缓存命中率统计
  - 缓存清理
- [ ] 9.1.3 实现报表数据缓存
  - 短期缓存
  - 增量更新
  - 缓存失效

### 9.2 实现批量操作优化
- [ ] 9.2.1 优化批量导入
  - 分批处理
  - 并发导入
  - 错误恢复
- [ ] 9.2.2 优化批量对账
  - 分批对账
  - 进度显示
  - 结果汇总
- [ ] 9.2.3 优化批量查询
  - 分页查询
  - 字段过滤
  - 索引优化

## 阶段 10：文档和部署 (Phase 10)

### 10.1 编写用户文档
- [ ] 10.1.1 编写《氧化加工厂版使用手册》
  - 快速开始指南
  - 功能详细说明
  - 常见问题解答
  - 操作视频链接
- [ ] 10.1.2 编写操作教程
  - 订单录入教程
  - 对账操作教程
  - 报表查询教程
  - 数据导入教程
- [ ] 10.1.3 编写配置说明
  - 配置文件说明
  - 参数配置指南
  - 高级配置选项

### 10.2 打包和部署
- [ ] 10.2.1 配置打包脚本
  - 更新 `build_exe.bat`
  - 配置PyInstaller参数
  - 添加资源文件
- [ ] 10.2.2 创建安装包
  - 打包EXE文件
  - 打包配置文件
  - 打包模板文件
  - 打包示例数据
  - 打包用户文档
- [ ] 10.2.3 测试部署包
  - 在干净环境测试
  - 测试所有功能
  - 测试示例数据
  - 收集反馈

### 10.3 编写开发文档
- [ ] 10.3.1 编写代码文档
  - 模块说明
  - 函数文档字符串
  - 类文档字符串
  - API文档
- [ ] 10.3.2 编写架构文档
  - 系统架构图
  - 数据流图
  - 模块依赖图
- [ ] 10.3.3 编写维护文档
  - 常见问题排查
  - 日志分析指南
  - 性能调优指南

## 阶段 11：测试和验证 (Phase 11)

### 11.1 单元测试
- [ ] 11.1.1 测试订单管理模块
  - 测试订单创建
  - 测试订单查询
  - 测试订单更新
  - 测试订单统计
- [ ] 11.1.2 测试对账引擎
  - 测试精确匹配
  - 测试部分对账
  - 测试余额计算
  - 测试对账记录
- [ ] 11.1.3 测试AI分类器
  - 测试规则匹配
  - 测试AI推断
  - 测试学习机制
  - 测试置信度评估
- [ ] 11.1.4 测试报表生成器
  - 测试各类报表生成
  - 测试数据准确性
  - 测试格式正确性
  - 测试导出功能

### 11.2 集成测试
- [ ] 11.2.1 测试完整业务流程
  - 订单录入→收款→对账→报表
  - 银行流水导入→分类→对账
  - 示例数据加载→操作→清除
- [ ] 11.2.2 测试数据一致性
  - 测试对账金额一致性
  - 测试余额计算正确性
  - 测试报表数据准确性
- [ ] 11.2.3 测试异常处理
  - 测试网络异常
  - 测试数据异常
  - 测试用户取消操作

### 11.3 用户验收测试
- [ ] 11.3.1 小白会计操作测试
  - 测试首次使用体验
  - 测试日常操作流程
  - 测试错误恢复
  - 收集用户反馈
- [ ] 11.3.2 典型业务场景测试
  - 测试多笔合并付款
  - 测试分批付款
  - 测试外发加工记录
  - 测试月末结算
- [ ] 11.3.3 性能压力测试
  - 测试大量订单处理
  - 测试大量流水导入
  - 测试报表生成速度
  - 测试系统响应时间

## 阶段 12：优化和完善 (Phase 12)

### 12.1 根据测试反馈优化
- [ ] 12.1.1 修复发现的Bug
  - 记录Bug清单
  - 优先级排序
  - 逐个修复
  - 回归测试
- [ ] 12.1.2 优化用户体验
  - 简化操作流程
  - 优化界面布局
  - 改进提示信息
  - 增加快捷操作
- [ ] 12.1.3 性能优化
  - 优化慢查询
  - 减少API调用
  - 优化内存使用
  - 提升响应速度

### 12.2 功能增强
- [ ] 12.2.1 添加高级功能
  - 批量修改订单
  - 批量对账
  - 自定义报表
  - 数据导出
- [ ] 12.2.2 添加辅助功能
  - 快捷键支持
  - 操作历史记录
  - 收藏常用功能
  - 自定义菜单

### 12.3 最终验收
- [ ] 12.3.1 完整功能验收
  - 验收所有需求
  - 验收所有报表
  - 验收所有文档
- [ ] 12.3.2 性能验收
  - 验收响应时间
  - 验收并发处理
  - 验收数据容量
- [ ] 12.3.3 交付准备
  - 准备交付清单
  - 准备培训材料
  - 准备技术支持文档

## 任务优先级说明

- **P0 (最高优先级)**：阶段1、阶段2、阶段3 - 核心功能
- **P1 (高优先级)**：阶段4、阶段5、阶段6 - 重要功能
- **P2 (中优先级)**：阶段7、阶段8、阶段9 - 优化功能
- **P3 (低优先级)**：阶段10、阶段11、阶段12 - 完善功能

## 预计工作量

- 总任务数：约150个子任务
- 预计工期：4-6周
- 建议团队：1-2名开发人员

## 里程碑

1. **里程碑1**：完成基础架构和数据模型（第1周）
2. **里程碑2**：完成订单管理和对账引擎（第2-3周）
3. **里程碑3**：完成AI分类和报表生成（第4周）
4. **里程碑4**：完成示例数据和用户界面（第5周）
5. **里程碑5**：完成测试和交付（第6周）

