# 氧化加工厂财务助手系统优化 - 项目总览

## 📌 项目概述

本项目旨在优化现有的飞书财务助手系统，使其完美适配氧化加工厂的业务特点，为小白会计提供简单易用、功能强大的财务管理工具。

## 🎯 核心目标

1. **支持行业特性**：多种计价单位（件/条/只/个/米长/米重/平方）、外发加工管理
2. **灵活对账**：支持多笔合并付款、分批付款等非一一对应场景
3. **智能分类**：预置氧化加工行业费用分类规则，AI自动识别
4. **简化操作**：为小白会计设计，依葫芦画瓢即可上手
5. **完整示例**：提供真实场景的示例数据，测试好最优效果

## 📁 文档结构

```
.kiro/specs/oxidation-factory-optimization/
├── README.md              # 本文件 - 项目总览
├── requirements.md        # 需求文档 - 详细的功能需求和验收标准
├── design.md              # 设计文档 - 系统架构、数据模型、算法设计
├── tasks.md               # 任务列表 - 分阶段的实施任务清单
└── QUICKSTART.md          # 快速开始 - 5分钟上手指南
```

## 🚀 快速开始

### 对于开发人员

1. **阅读需求文档**：了解业务需求和验收标准
   ```bash
   查看 requirements.md
   ```

2. **阅读设计文档**：了解技术方案和实现细节
   ```bash
   查看 design.md
   ```

3. **按任务列表实施**：按阶段完成开发任务
   ```bash
   查看 tasks.md
   ```

### 对于最终用户（小白会计）

1. **阅读快速开始指南**：5分钟学会基本操作
   ```bash
   查看 QUICKSTART.md
   ```

2. **加载示例数据**：在示例数据上练习
   ```bash
   运行 run.bat → 输入 31
   ```

3. **查看操作教程**：学习典型业务场景
   ```bash
   查看 QUICKSTART.md 中的"典型业务场景"
   ```

## 🌟 核心功能亮点

### 1. 订单管理

- ✅ 支持7种计价单位（件/条/只/个/米长/米重/平方）
- ✅ 自动计算订单金额和预计利润
- ✅ 记录外发工序和成本
- ✅ 跟踪订单状态和收款进度
- ✅ 分步向导，简单易用

### 2. 灵活对账

- ✅ 一笔流水对应多个订单（多笔合并付款）
- ✅ 多笔流水对应一个订单（分批付款）
- ✅ 自动匹配 + 手动调整
- ✅ 实时显示应收应付余额
- ✅ 对账历史可追溯、可撤销

### 3. 智能分类

- ✅ 预置氧化加工行业规则库
  - 原材料：三酸、片碱、亚钠、色粉、除油剂
  - 外发加工：喷砂、拉丝、抛光
  - 固定支出：房租、水电费、工资
- ✅ AI自动分类（GLM-4）
- ✅ 学习用户修正习惯
- ✅ 置信度评估，低置信度标记待确认

### 4. 往来单位管理

- ✅ 支持多个别名（"华为" = "华为技术有限公司"）
- ✅ 自动识别往来单位
- ✅ 批量导入往来单位
- ✅ 实时显示应收应付余额

### 5. 行业专用报表

- ✅ 加工费收入明细表（按客户、计价单位、时间统计）
- ✅ 外发成本统计表（按工序、供应商统计）
- ✅ 原材料消耗统计表（按材料类型统计）
- ✅ 往来对账表（应收应付余额）
- ✅ 月度利润表（收入、成本、费用汇总）
- ✅ 一键导出Excel

### 6. 示例数据

- ✅ 5个客户（华为、小米、OPPO、比亚迪、格力）
- ✅ 8个供应商（喷砂厂、拉丝厂、化工原料等）
- ✅ 10个加工订单（覆盖所有计价单位和工序组合）
- ✅ 30条银行流水（收入、支出、对账场景）
- ✅ 一键加载/清除

## 📊 业务场景覆盖

### 收入场景

- ✅ 客户下单 → 生产 → 完工 → 收款 → 对账
- ✅ 多笔订单合并收款
- ✅ 单笔订单分批收款
- ✅ 预付款 + 尾款
- ✅ 零星小件加工（散户）

### 支出场景

- ✅ 采购原材料（三酸、片碱、亚钠、色粉、除油剂）
- ✅ 外发加工（喷砂、拉丝、抛光）
- ✅ 采购挂具
- ✅ 固定支出（房租、水电费）
- ✅ 日常费用（办公用品、加油、餐饮）
- ✅ 工资发放

### 对账场景

- ✅ 精确匹配（金额完全相等）
- ✅ 部分对账（一笔流水对应多个订单）
- ✅ 分批对账（多笔流水对应一个订单）
- ✅ 手动调整对账关系
- ✅ 对账撤销

## 🏗️ 技术架构

### 分层架构

```
用户交互层 (CLI/GUI)
    ↓
业务逻辑层 (订单管理、对账引擎、AI分类、报表生成)
    ↓
数据访问层 (飞书API、Excel读写、本地缓存)
    ↓
数据存储层 (飞书多维表格、本地配置、备份文件)
```

### 核心模块

1. **OrderManager** - 订单管理模块
2. **ReconciliationEngine** - 对账引擎
3. **IndustryClassifier** - 行业分类器
4. **ReportGenerator** - 报表生成器
5. **DemoDataGenerator** - 示例数据生成器

### 数据模型

- **加工订单表** - 记录加工订单信息
- **日常台账表** - 记录银行流水（扩展字段）
- **往来单位表** - 管理客户和供应商
- **对账记录表** - 记录对账历史
- **费用分类规则表** - 管理分类规则

## 📈 实施计划

### 阶段划分

| 阶段 | 内容 | 工期 | 优先级 |
|------|------|------|--------|
| 阶段1 | 基础架构和数据模型 | 1周 | P0 |
| 阶段2 | 订单管理模块 | 1周 | P0 |
| 阶段3 | 对账引擎 | 1周 | P0 |
| 阶段4 | AI分类优化 | 1周 | P1 |
| 阶段5 | 报表生成 | 1周 | P1 |
| 阶段6 | 示例数据和模板 | 1周 | P1 |
| 阶段7-12 | 优化和完善 | 2周 | P2-P3 |

### 里程碑

- **里程碑1**：完成基础架构和数据模型（第1周）
- **里程碑2**：完成订单管理和对账引擎（第2-3周）
- **里程碑3**：完成AI分类和报表生成（第4周）
- **里程碑4**：完成示例数据和用户界面（第5周）
- **里程碑5**：完成测试和交付（第6周）

## ✅ 验收标准

### 功能验收

- [ ] 支持所有7种计价单位
- [ ] 支持多对多对账
- [ ] AI分类准确率 > 85%
- [ ] 生成所有5类行业报表
- [ ] 示例数据完整可用
- [ ] 操作向导简单易懂

### 性能验收

- [ ] 单次导入100条记录 < 3秒
- [ ] 生成任意报表 < 5秒
- [ ] 支持10000条历史记录查询

### 用户验收

- [ ] 小白会计5分钟上手
- [ ] 日常操作流程顺畅
- [ ] 错误提示清晰明确
- [ ] 文档完整易懂

## 📚 相关文档

### 用户文档

- [快速开始指南](QUICKSTART.md) - 5分钟上手
- [使用手册_氧化加工厂版.txt](../../使用手册_氧化加工厂版.txt) - 完整操作手册
- [操作视频教程](#) - 视频演示（待制作）

### 开发文档

- [需求文档](requirements.md) - 功能需求和验收标准
- [设计文档](design.md) - 系统架构和技术方案
- [任务列表](tasks.md) - 实施任务清单
- [API文档](#) - 接口文档（待编写）

### 配置文档

- [配置说明](#) - 配置文件说明（待编写）
- [部署指南](#) - 部署步骤（待编写）

## 🔧 开发环境

### 技术栈

- **语言**：Python 3.8+
- **框架**：飞书开放平台 API (lark-oapi)
- **数据处理**：Pandas, openpyxl
- **AI模型**：ZhipuAI GLM-4
- **数据存储**：飞书多维表格

### 依赖安装

```bash
pip install -r requirements.txt
```

### 运行测试

```bash
# 生成示例数据
python create_oxidation_demo_data.py

# 运行主程序
python CW.py
```

## 🤝 贡献指南

### 开发流程

1. 从 `tasks.md` 选择任务
2. 创建功能分支
3. 编写代码和测试
4. 提交代码审查
5. 合并到主分支

### 代码规范

- 遵循 PEP 8 规范
- 函数添加文档字符串
- 关键逻辑添加注释
- 提交信息清晰明确

## 📞 联系方式

- **项目负责人**：[姓名]
- **技术支持**：[联系方式]
- **问题反馈**：[Issue地址]

## 📄 许可证

[许可证类型]

---

**最后更新**：2026-02-09  
**版本**：V1.0  
**状态**：规划中

